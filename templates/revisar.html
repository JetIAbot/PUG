<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Revisar y Completar Datos</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; background-color: #f8f9fa; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card h2 { margin-top: 0; color: #007bff; }
        .horario-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; }
        .horario-item:last-child { border-bottom: none; }
        .empty { color: #888; font-style: italic; }
        button { font-size: 1.2em; padding: 12px 25px; cursor: pointer; width: 100%; background-color: #28a745; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #218838; }
        .form-group { margin-bottom: 15px; }
        label { font-weight: bold; }
        .license-details { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
    </style>
</head>
<body>
    <h1>Revisa y Completa tus Datos</h1>
    <p>Confirma que la información extraída es correcta y completa los datos adicionales antes de guardar.</p>

    <form action="{{ url_for('guardar_horario') }}" method="post">
        <div class="card">
            <h2>Datos Personales</h2>
            <p><strong>Matrícula:</strong> {{ datos.datos_personales.matricola }}</p>
            <p><strong>Nombre:</strong> {{ datos.datos_personales.nome }}</p>
            <p><strong>Apellido:</strong> {{ datos.datos_personales.cognome }}</p>
            <!-- CORRECCIÓN 5: Mostramos la fecha de nacimiento extraída -->
            <p><strong>Fecha de Nacimiento:</strong> {{ datos.datos_personales.data_nascita }}</p>
            
            <input type="hidden" name="matricola" value="{{ datos.datos_personales.matricola }}">
            <input type="hidden" name="nome" value="{{ datos.datos_personales.nome }}">
            <input type="hidden" name="cognome" value="{{ datos.datos_personales.cognome }}">
            <!-- CORRECCIÓN 6: Añadimos un campo oculto para enviar la fecha de nacimiento -->
            <input type="hidden" name="data_nascita" value="{{ datos.datos_personales.data_nascita }}">
        </div>

        <div class="card">
            <h2>Horario Extraído</h2>
            {% if datos.horario %}
                {% for clase in datos.horario %}
                    <div class="horario-item">
                        <!-- CORRECCIÓN 1: Se usa 'clase.hora' en lugar de 'clase.bloque_horario' -->
                        <span><strong>{{ clase.dia }}</strong> - Bloque {{ clase.hora }}</span>
                        <span>{{ clase.info_clase }}</span>
                    </div>
                {% endfor %}
            {% else %}
                <p class="empty">No se encontraron clases en el horario.</p>
            {% endif %}
            <!-- CORRECCIÓN 2: Se añade un campo oculto para enviar el horario como JSON -->
            <input type="hidden" name="horario_json" value="{{ datos.horario | tojson }}">
        </div>

        <!-- CORRECCIÓN 3: Se añade la sección para la información de conducción -->
        <div class="card">
            <h2>Información de Conducción</h2>
            <div class="form-group">
                <label>¿Tienes licencia de conducir?</label><br>
                <input type="radio" id="licencia_si" name="tiene_licencia" value="si" required> <label for="licencia_si">Sí</label>
                <input type="radio" id="licencia_no" name="tiene_licencia" value="no" checked> <label for="licencia_no">No</label>
            </div>

            <div id="license-details" class="license-details">
                <div class="form-group">
                    <label>Tipo de Licencia (selecciona todas las que apliquen):</label><br>
                    <input type="checkbox" id="tipo_a" name="tipo_licencia" value="A"> <label for="tipo_a">A (Moto)</label><br>
                    <input type="checkbox" id="tipo_b" name="tipo_licencia" value="B"> <label for="tipo_b">B (Auto)</label><br>
                    <input type="checkbox" id="tipo_c" name="tipo_licencia" value="C"> <label for="tipo_c">C (Otros)</label>
                </div>
                <div class="form-group">
                    <label for="vencimiento_licencia">Fecha de Vencimiento:</label>
                    <input type="date" id="vencimiento_licencia" name="vencimiento_licencia" style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
            </div>
        </div>

        <button type="submit">Confirmar y Guardar en la Base de Datos</button>
    </form>

    <script>
        // Script para mostrar/ocultar los detalles de la licencia
        const licenseDetails = document.getElementById('license-details');
        document.querySelectorAll('input[name="tiene_licencia"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'si') {
                    licenseDetails.style.display = 'block';
                } else {
                    licenseDetails.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>